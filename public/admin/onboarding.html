
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Onboarding – Funeral Home Setup</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="min-h-screen bg-slate-950 text-slate-900 flex items-center justify-center p-6">
  <div class="w-full max-w-3xl bg-white rounded-2xl shadow-2xl overflow-hidden border border-slate-200">

    <!-- HEADER / PROGRESS -->
    <div class="px-6 py-4 border-b border-slate-200 bg-slate-900 text-slate-50">
      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-xl font-semibold">Welcome to your Funeral Home Console</h1>
          <p class="text-xs text-slate-300">Let’s set up your branding and basic details in a few quick steps.</p>
        </div>
        <span id="stepLabel" class="text-xs bg-slate-800 px-3 py-1 rounded-full">Step 1 of 4</span>
      </div>
      <div class="mt-3 w-full bg-slate-800 rounded-full h-1.5 overflow-hidden">
        <div id="progressBar" class="h-1.5 bg-amber-400 rounded-full" style="width: 25%;"></div>
      </div>
    </div>

    <!-- BODY -->
    <div class="px-6 py-5 text-sm">

      <!-- STEP 1: BRANDING -->
      <div id="step-1" class="step">
        <h2 class="text-lg font-semibold mb-2 text-slate-800">Branding</h2>
        <p class="text-xs text-slate-500 mb-4">
          Set your logo, hero image, and basic visual style. You can change these later in Settings.
        </p>

        <div class="grid gap-4 md:grid-cols-2">
          <div>
            <label class="block text-xs text-slate-600 mb-1">Logo image URL</label>
            <input id="logoUrl" class="w-full border rounded-lg px-3 py-2 text-xs border-slate-300 focus:outline-none focus:ring-2 focus:ring-blue-400"
                   placeholder="https://your-site.com/logo.png" />
            <p class="text-[10px] text-slate-400 mt-1">We’ll support uploads later; for now use a direct image link.</p>
          </div>
          <div>
            <label class="block text-xs text-slate-600 mb-1">Hero / header image URL</label>
            <input id="heroUrl" class="w-full border rounded-lg px-3 py-2 text-xs border-slate-300 focus:outline-none focus:ring-2 focus:ring-blue-400"
                   placeholder="https://your-site.com/header.jpg" />
          </div>

          <div>
            <label class="block text-xs text-slate-600 mb-1">Brand accent color</label>
            <select id="brandColor" class="w-full border rounded-lg px-3 py-2 text-xs border-slate-300 focus:outline-none focus:ring-2 focus:ring-blue-400">
              <option value="">Choose a color…</option>
              <option value="#fbbf24">Gold / Amber</option>
              <option value="#2563eb">Royal Blue</option>
              <option value="#7f1d1d">Deep Burgundy</option>
              <option value="#047857">Emerald</option>
              <option value="#111827">Charcoal</option>
            </select>
          </div>

          <div>
            <label class="block text-xs text-slate-600 mb-1">Theme style</label>
            <select id="theme" class="w-full border rounded-lg px-3 py-2 text-xs border-slate-300 focus:outline-none focus:ring-2 focus:ring-blue-400">
              <option value="hybrid">Hybrid (light cards on dark background)</option>
              <option value="light">Light & clean</option>
              <option value="dark">Dark & elegant</option>
              <option value="luxury">Luxury black & gold</option>
              <option value="pastel">Soft pastel</option>
            </select>
          </div>
        </div>
      </div>

      <!-- STEP 2: BUSINESS INFO -->
      <div id="step-2" class="step hidden">
        <h2 class="text-lg font-semibold mb-2 text-slate-800">Business Information</h2>
        <p class="text-xs text-slate-500 mb-4">
          These details appear on your public website and in contact sections.
        </p>

        <div class="grid gap-4 md:grid-cols-2">
          <div class="md:col-span-2">
            <label class="block text-xs text-slate-600 mb-1">Funeral home name</label>
            <input id="businessName" class="w-full border rounded-lg px-3 py-2 text-xs border-slate-300"
                   placeholder="W. Edwards Funeral Services" />
          </div>

          <div>
            <label class="block text-xs text-slate-600 mb-1">Funeral director name</label>
            <input id="directorName" class="w-full border rounded-lg px-3 py-2 text-xs border-slate-300"
                   placeholder="Carl Brathwaite" />
          </div>

          <div>
            <label class="block text-xs text-slate-600 mb-1">Primary email</label>
            <input id="email" type="email" class="w-full border rounded-lg px-3 py-2 text-xs border-slate-300"
                   placeholder="info@yourfuneralhome.com" />
          </div>

          <div>
            <label class="block text-xs text-slate-600 mb-1">Phone</label>
            <input id="phone" class="w-full border rounded-lg px-3 py-2 text-xs border-slate-300"
                   placeholder="+1 (246) 555-0000" />
          </div>

          <div>
            <label class="block text-xs text-slate-600 mb-1">Country</label>
            <input id="country" class="w-full border rounded-lg px-3 py-2 text-xs border-slate-300"
                   placeholder="Barbados" />
          </div>

          <div>
            <label class="block text-xs text-slate-600 mb-1">Website (optional)</label>
            <input id="website" class="w-full border rounded-lg px-3 py-2 text-xs border-slate-300"
                   placeholder="https://www.yourfuneralhome.com" />
          </div>

          <div class="md:col-span-2">
            <label class="block text-xs text-slate-600 mb-1">Address</label>
            <input id="address" class="w-full border rounded-lg px-3 py-2 text-xs border-slate-300"
                   placeholder="Street, City, Parish" />
          </div>

          <div class="md:col-span-2">
            <label class="block text-xs text-slate-600 mb-1">About your funeral home</label>
            <textarea id="about" rows="3"
                      class="w-full border rounded-lg px-3 py-2 text-xs border-slate-300 resize-y"
                      placeholder="Short description for your public About section."></textarea>
          </div>
        </div>
      </div>

      <!-- STEP 3: WEBSITE OPTIONS -->
      <div id="step-3" class="step hidden">
        <h2 class="text-lg font-semibold mb-2 text-slate-800">Website Options</h2>
        <p class="text-xs text-slate-500 mb-4">
          Choose how your public memorial site should look and what features to enable.
        </p>

        <div class="grid gap-4 md:grid-cols-2">
          <div>
            <label class="block text-xs text-slate-600 mb-1">Homepage layout</label>
            <select id="layoutStyle"
                    class="w-full border rounded-lg px-3 py-2 text-xs border-slate-300">
              <option value="simple">Simple & traditional</option>
              <option value="modern">Modern cards</option>
              <option value="luxury">Luxury hero & sections</option>
            </select>
          </div>

          <div>
            <label class="block text-xs text-slate-600 mb-1">Memorial layout</label>
            <select id="memorialLayout"
                    class="w-full border rounded-lg px-3 py-2 text-xs border-slate-300">
              <option value="cards">Card grid</option>
              <option value="list">List with details</option>
              <option value="gallery">Large photo gallery</option>
            </select>
          </div>

          <div class="md:col-span-2">
            <label class="block text-xs text-slate-600 mb-1">Default cover image URL (optional)</label>
            <input id="defaultCover"
                   class="w-full border rounded-lg px-3 py-2 text-xs border-slate-300"
                   placeholder="Used when a memorial doesn’t have a photo." />
          </div>
        </div>

        <div class="mt-4 grid gap-2 text-xs">
          <label class="inline-flex items-center gap-2">
            <input id="enableCondolences" type="checkbox" class="rounded border-slate-400" checked />
            <span>Enable online condolences / guestbook</span>
          </label>
          <label class="inline-flex items-center gap-2">
            <input id="enableGallery" type="checkbox" class="rounded border-slate-400" checked />
            <span>Enable photo gallery on memorial pages</span>
          </label>
          <label class="inline-flex items-center gap-2">
            <input id="enableLivestream" type="checkbox" class="rounded border-slate-400" checked />
            <span>Show livestream link section when available</span>
          </label>
        </div>
      </div>

      <!-- STEP 4: REVIEW -->
      <div id="step-4" class="step hidden">
        <h2 class="text-lg font-semibold mb-2 text-slate-800">Review & Finish</h2>
        <p class="text-xs text-slate-500 mb-4">
          Here’s a quick summary of your setup. You can go back to adjust anything before finishing.
        </p>

        <div class="space-y-3 text-xs">
          <div class="border border-slate-200 rounded-lg p-3">
            <h3 class="font-semibold text-slate-800 mb-1">Branding</h3>
            <p id="summaryBranding" class="text-slate-600 text-xs"></p>
          </div>
          <div class="border border-slate-200 rounded-lg p-3">
            <h3 class="font-semibold text-slate-800 mb-1">Business info</h3>
            <p id="summaryBusiness" class="text-slate-600 text-xs"></p>
          </div>
          <div class="border border-slate-200 rounded-lg p-3">
            <h3 class="font-semibold text-slate-800 mb-1">Website options</h3>
            <p id="summaryWebsite" class="text-slate-600 text-xs"></p>
          </div>
        </div>

        <p id="saveStatus" class="mt-4 text-xs text-slate-500"></p>
      </div>
    </div>

    <!-- FOOTER BUTTONS -->
    <div class="px-6 py-4 border-t border-slate-200 bg-slate-50 flex items-center justify-between">
      <button id="backBtn"
              class="text-xs px-4 py-2 rounded-lg border border-slate-300 text-slate-700 hover:bg-slate-100"
              disabled>
        Back
      </button>
      <div class="flex items-center gap-2">
        <span id="tenantSlugLabel" class="text-[10px] text-slate-400"></span>
        <button id="nextBtn"
                class="text-xs px-4 py-2 rounded-lg bg-blue-600 text-white font-semibold hover:bg-blue-700">
          Next
        </button>
      </div>
    </div>
  </div>

  <script>
    // --- basic tenant detection ---
    function getTenantSlug() {
      const params = new URLSearchParams(window.location.search);
      return params.get("tenant") ||
             localStorage.getItem("we_admin_tenant") ||
             "w-edwards";
    }

    const tenantSlug = getTenantSlug();
    document.getElementById("tenantSlugLabel").textContent = "Tenant: " + tenantSlug;

    // --- steps + state ---
    let currentStep = 1;
    const totalSteps = 4;

    const stepEls = {
      1: document.getElementById("step-1"),
      2: document.getElementById("step-2"),
      3: document.getElementById("step-3"),
      4: document.getElementById("step-4"),
    };

    const stepLabel = document.getElementById("stepLabel");
    const progressBar = document.getElementById("progressBar");
    const backBtn = document.getElementById("backBtn");
    const nextBtn = document.getElementById("nextBtn");

    const settingsData = {
      branding: {},
      business: {},
      website: {}
    };

    function updateStepUI() {
      Object.values(stepEls).forEach(el => el.classList.add("hidden"));
      stepEls[currentStep].classList.remove("hidden");

      stepLabel.textContent = `Step ${currentStep} of ${totalSteps}`;
      const pct = (currentStep / totalSteps) * 100;
      progressBar.style.width = pct + "%";

      backBtn.disabled = currentStep === 1;
      nextBtn.textContent = currentStep === totalSteps ? "Finish setup" : "Next";
    }

    function collectStepData() {
      if (currentStep === 1) {
        settingsData.branding = {
          logoUrl: document.getElementById("logoUrl").value.trim(),
          heroUrl: document.getElementById("heroUrl").value.trim(),
          brandColor: document.getElementById("brandColor").value,
          theme: document.getElementById("theme").value || "hybrid",
        };
      } else if (currentStep === 2) {
        settingsData.business = {
          businessName: document.getElementById("businessName").value.trim(),
          directorName: document.getElementById("directorName").value.trim(),
          email: document.getElementById("email").value.trim(),
          phone: document.getElementById("phone").value.trim(),
          country: document.getElementById("country").value.trim(),
          website: document.getElementById("website").value.trim(),
          address: document.getElementById("address").value.trim(),
          about: document.getElementById("about").value.trim(),
        };
      } else if (currentStep === 3) {
        settingsData.website = {
          layoutStyle: document.getElementById("layoutStyle").value,
          memorialLayout: document.getElementById("memorialLayout").value,
          defaultCover: document.getElementById("defaultCover").value.trim(),
          enableCondolences: document.getElementById("enableCondolences").checked,
          enableGallery: document.getElementById("enableGallery").checked,
          enableLivestream: document.getElementById("enableLivestream").checked,
        };
      } else if (currentStep === 4) {
        // populate summary
        document.getElementById("summaryBranding").textContent =
          `Theme: ${settingsData.branding.theme || "hybrid"}, ` +
          `Color: ${settingsData.branding.brandColor || "default"}, ` +
          `Logo: ${settingsData.branding.logoUrl || "none"}, ` +
          `Hero: ${settingsData.branding.heroUrl || "none"}`;

        document.getElementById("summaryBusiness").textContent =
          `${settingsData.business.businessName || "No name yet"} – ` +
          `${settingsData.business.directorName || "No director set"}; ` +
          `Email: ${settingsData.business.email || "none"}, ` +
          `Phone: ${settingsData.business.phone || "none"}, ` +
          `Country: ${settingsData.business.country || "none"}`;

        document.getElementById("summaryWebsite").textContent =
          `Homepage: ${settingsData.website.layoutStyle || "simple"}, ` +
          `Memorial layout: ${settingsData.website.memorialLayout || "cards"}, ` +
          `Condolences: ${settingsData.website.enableCondolences ? "On" : "Off"}, ` +
          `Gallery: ${settingsData.website.enableGallery ? "On" : "Off"}, ` +
          `Livestream: ${settingsData.website.enableLivestream ? "On" : "Off"}`;
      }
    }

    async function saveSettingsToServer() {
      const saveStatus = document.getElementById("saveStatus");
      saveStatus.textContent = "Saving your settings…";

      try {
        const res = await fetch(`/api/tenant/${tenantSlug}/settings`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(settingsData),
        });

        const data = await res.json();
        if (!res.ok || !data.success) {
          saveStatus.textContent = data.error || "Failed to save settings. Please try again.";
          saveStatus.classList.add("text-red-500");
          return;
        }

        saveStatus.textContent = "Settings saved! Redirecting to your dashboard…";
        saveStatus.classList.remove("text-red-500");
        saveStatus.classList.add("text-green-600");

        setTimeout(() => {
          window.location.href = `/admin/admin-dashboard.html?tenant=${encodeURIComponent(tenantSlug)}`;
        }, 1200);

      } catch (err) {
        console.error("Save error:", err);
        saveStatus.textContent = "Network error while saving. Please try again.";
        saveStatus.classList.add("text-red-500");
      }
    }

    backBtn.addEventListener("click", () => {
      if (currentStep > 1) {
        currentStep--;
        updateStepUI();
      }
    });

    nextBtn.addEventListener("click", () => {
      collectStepData();
      if (currentStep < totalSteps) {
        currentStep++;
        updateStepUI();
      } else {
        // final save
        collectStepData();
        saveSettingsToServer();
      }
    });

    // Pre-fill from existing tenant info where possible
    async function hydrateFromTenant() {
      try {
        const res = await fetch(`/api/tenant/${tenantSlug}`);
        if (!res.ok) return;
        const t = await res.json();
        if (t.name) document.getElementById("businessName").value = t.name;
        if (t.email) document.getElementById("email").value = t.email;
        if (t.phone) document.getElementById("phone").value = t.phone;
        if (t.country) document.getElementById("country").value = t.country;
        if (t.website) document.getElementById("website").value = t.website;
        if (t.brandColor) document.getElementById("brandColor").value = t.brandColor;
        if (t.theme) document.getElementById("theme").value = t.theme;
      } catch (err) {
        console.error("Hydrate tenant error:", err);
      }
    }

    updateStepUI();
    hydrateFromTenant();
  </script>
</body>
</html>
