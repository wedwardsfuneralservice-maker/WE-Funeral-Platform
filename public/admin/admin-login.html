<script>
// Auto-tenant selection for single-funeral-home install
const FIXED_TENANT = "w-edwards";

// Toggle password visibility
document.getElementById("toggleShow").addEventListener("click", () => {
    const input = document.getElementById("adminKey");
    if (input.type === "password") {
        input.type = "text";
        toggleShow.innerText = "Hide";
    } else {
        input.type = "password";
        toggleShow.innerText = "Show";
    }
});

// Load tenant info automatically
document.addEventListener("DOMContentLoaded", async () => {
    const tenantName = document.getElementById("tenantName");
    const trialWarn = document.getElementById("trialWarn");

    try {
        const res = await fetch(`/api/tenant/${FIXED_TENANT}/status`);
        const data = await res.json();

        if (data.error) {
            tenantName.innerText = "Tenant not found.";
            return;
        }

        tenantName.innerText = "Funeral Home: W. Edwards Funeral Services";

        if (data.trialExpired) {
            trialWarn.style.display = "block";
        }

    } catch (err) {
        tenantName.innerText = "Error loading tenant.";
    }
});

// Login handler
document.getElementById("loginForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const key = document.getElementById("adminKey").value.trim();
    const btn = document.getElementById("loginBtn");
    const errorMsg = document.getElementById("errorMsg");

    if (!key) {
        errorMsg.innerText = "Please enter your admin password.";
        errorMsg.style.display = "block";
        return;
    }

    errorMsg.style.display = "none";
    btn.classList.add("loading");

    // Login request
    const response = await fetch("/api/admin/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ tenant: FIXED_TENANT, key })
    });

    const data = await response.json();
    btn.classList.remove("loading");

    if (data.success) {
        // Redirect to correct dashboard file
        window.location.href = "/admin/admin-dashboard.html";
    } else {
        errorMsg.innerText = data.error || "Login failed.";
        errorMsg.style.display = "block";
    }
});
</script>
